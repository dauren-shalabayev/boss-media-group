# File Storage API

REST API сервис для управления файлами в системе электронного документооборота, построенный на FastAPI.

## Описание

Система предоставляет API для:
- Аутентификации пользователей с JWT токенами
- Управления файлами с различными уровнями доступа
- Управления пользователями и их ролями
- Контроля доступа на основе ролей и отделов

## Роли пользователей

### USER
- Может загружать только PDF файлы до 10MB
- Может создавать только PRIVATE файлы
- Видит PUBLIC файлы и файлы своего отдела
- Может удалять только свои файлы

### MANAGER
- Может загружать любые файлы до 50MB
- Может создавать файлы с любым уровнем видимости
- Видит файлы всех отделов
- Может удалять файлы своего отдела

### ADMIN
- Может загружать любые файлы до 100MB
- Полный доступ ко всем файлам
- Может удалять любые файлы
- Может управлять пользователями

## Уровни видимости файлов

- **PRIVATE**: Видит только владелец и ADMIN
- **DEPARTMENT**: Видят все в том же отделе, MANAGER всех отделов, ADMIN
- **PUBLIC**: Видят все пользователи

## Технологии

- **FastAPI** - веб-фреймворк
- **SQLAlchemy** - ORM для работы с базой данных
- **SQLite** - база данных
- **JWT** - аутентификация
- **bcrypt** - хеширование паролей
- **Docker** - контейнеризация

## Запуск

### Требования

- Docker
- Docker Compose

### Быстрый запуск

#### Вариант 1: Docker (рекомендуется)

1. Убедитесь, что Docker Desktop запущен
2. Клонируйте репозиторий
3. Перейдите в папку проекта
4. Запустите приложение:

```bash
# Автоматический запуск с проверкой Docker
./start.sh

# Или вручную
docker compose up --build
```

#### Вариант 2: Локальный запуск

1. Убедитесь, что установлен Python 3.8+
2. Клонируйте репозиторий
3. Перейдите в папку проекта
4. Запустите приложение:

```bash
./run_local.sh
```

Приложение будет доступно по адресу: http://localhost:8000

### Документация и интерфейс

После запуска доступны:
- **Веб-интерфейс**: http://localhost:8000/ui - удобный интерфейс для тестирования API
- **Swagger UI**: http://localhost:8000/docs - автоматически сгенерированная документация
- **ReDoc**: http://localhost:8000/redoc - альтернативная документация

## Демо-данные

При первом запуске автоматически создаются:

### Отделы
- dept1
- dept2

### Пользователи
- **user1** (USER, dept1) - пароль: password
- **manager1** (MANAGER, dept1) - пароль: password
- **admin1** (ADMIN, dept1) - пароль: password
- **user2** (USER, dept2) - пароль: password

## API Endpoints

### Аутентификация
- `POST /auth/login` - вход пользователя
- `GET /auth/me` - информация о текущем пользователе

### Файлы
- `POST /files/upload` - загрузка файла
- `GET /files/{file_id}` - информация о файле
- `GET /files/{file_id}/download` - скачивание файла
- `DELETE /files/{file_id}` - удаление файла
- `GET /files/` - список доступных файлов

### Пользователи (только для MANAGER/ADMIN)
- `POST /users/` - создание пользователя
- `GET /users/{user_id}` - информация о пользователе
- `PUT /users/{user_id}/role` - изменение роли пользователя
- `GET /users/` - список пользователей

## Структура проекта

```
├── main.py              # Главный файл приложения
├── config.py            # Конфигурация
├── database.py          # Настройка базы данных
├── models.py            # Модели SQLAlchemy
├── schemas.py           # Pydantic схемы
├── auth.py              # Аутентификация и JWT
├── crud.py              # CRUD операции
├── dependencies.py      # Зависимости для проверки прав
├── routers/             # Роутеры API
│   ├── auth.py         # Аутентификация
│   ├── files.py        # Управление файлами
│   └── users.py        # Управление пользователями
├── requirements.txt     # Зависимости Python
├── Dockerfile          # Docker образ
├── docker-compose.yml  # Docker Compose
├── start.sh            # Скрипт запуска Docker
├── run_local.sh        # Скрипт локального запуска
└── README.md           # Документация
```

## Разработка

### Локальный запуск

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Запустите приложение:
```bash
uvicorn main:app --reload
```

### Тестирование

API можно тестировать через Swagger UI по адресу http://localhost:8000/docs

## Безопасность

- Пароли хешируются с использованием bcrypt
- JWT токены для аутентификации
- Проверка прав доступа на основе ролей
- Валидация входных данных через Pydantic
- Ограничения на размер и тип файлов в зависимости от роли

## Лицензия

MIT 